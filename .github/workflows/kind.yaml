name: KIND Test

on:
  push:
    branches:
    - "main"
    paths:
    - 'k8s/kind/**'

permissions:
  contents: read

jobs:
  test:
    name: test
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332  # v4.1.7
      - run: ./k8s/kind/create-cluster.sh
        with:
          IP_FAMILY: dual
      - run: |
          kubectl apply -f ./k8s/kind/
          kubectl wait --for=condition=ready pod --all --timeout=300s

      - run: |
          kubectl exec -it deploy/sleep -- curl httpbin:8000/get
