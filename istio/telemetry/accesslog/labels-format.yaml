apiVersion: v1
data:
  mesh: |-
    accessLogFile: /dev/stdout
    defaultConfig:
      discoveryAddress: istiod.istio-system.svc:15012
      proxyMetadata: {}
      tracing:
        zipkin:
          address: zipkin.istio-system:9411
    enablePrometheusMerge: true
    extensionProviders:
    - name: file-log
      envoyFileAccessLog:
        path: /dev/stdout
        logFormat: 
          labels: 
            "startTime": "[%START_TIME%]"
            "method": "%REQ(:METHOD)%"
            "path": "%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%"
            "protocol": "%PROTOCOL%"
            "reponseCode": "%RESPONSE_CODE%"
            "reponseFlags": "%RESPONSE_FLAGS%"
            "failureRease": "%UPSTREAM_TRANSPORT_FAILURE_REASON%"
            "bytesReceived": "%BYTES_RECEIVED% %BYTES_SENT%"
            "duration": "%DURATION%"
            "envoyUpstreamServiceTime": "%RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)%"
            "forwardedFor": "%REQ(X-FORWARDED-FOR)%"
            "userAgent": "%REQ(USER-AGENT)%"
            "requestID": "%REQ(X-REQUEST-ID)%"
            "authority": "%REQ(:AUTHORITY)%"
            "host": "%UPSTREAM_HOST%" 
            "upstreamCluster": "%UPSTREAM_CLUSTER%"
            "upstreamLocalAdress": "%UPSTREAM_LOCAL_ADDRESS%"
            "downstreamLocalAddress": "%DOWNSTREAM_LOCAL_ADDRESS%"
            "downstreamRemoteAddress": "%DOWNSTREAM_REMOTE_ADDRESS%"
            "requestedServerName": "%REQUESTED_SERVER_NAME%"
            "routeName": "%ROUTE_NAME%"
    defaultProviders:
      accessLogging: 
      - file-log
    rootNamespace: istio-system
    trustDomain: cluster.local
  meshNetworks: 'networks: {}'
kind: ConfigMap
metadata:
  name: istio
  namespace: istio-system
